apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - namespaces.yaml
  
secretGenerator:
- name: {{ external_dns_credentials_secret }}
  namespace: {{ external_dns_namespace }}
  files:
  - credentials=ext-dns-crs.cred

helmCharts:

- name: kubernetes-secret-generator
  releaseName: kubernetes-secret-generator
  version: {{ kubernetes_secret_generator_helm_version }}
  namespace: default
  repo: https://helm.mittwald.de
  includeCRDs: true
- name: reflector
  releaseName: reflector
  version: {{ reflector_helm_version }}
  repo: https://emberstack.github.io/helm-charts
  namespace: reflector
  valuesInline:
    nameOverride: reflector
- name: base
  releaseName: istio-base
  version: {{ istio_helm_version }}
  repo: https://istio-release.storage.googleapis.com/charts
  valuesFile: istio-base-values.yaml
  namespace: {{ istio_namespace }}
  includeCRDs: true
- name: istiod
  releaseName: istiod
  version: {{ istio_helm_version }}
  repo: https://istio-release.storage.googleapis.com/charts
  valuesFile: istio-istiod-values.yaml
  namespace: {{ istio_namespace }}

- name: cert-manager
  releaseName: cert-manager
  version: {{ certmanager_helm_version }}
  repo: https://charts.jetstack.io
  namespace: {{ certmanager_namespace }}
  includeCRDs: true
  valuesInline:
    crds:
      enabled: true

- name: external-dns
  releaseName: external-dns
  version: {{ external_dns_helm_version }}
  repo: https://charts.bitnami.com/bitnami
  valuesFile: ext-dns-values.yaml
  namespace: {{ external_dns_namespace }}

- name: crossplane
  releaseName: crossplane
  version: {{ crossplane_helm_version }}
  repo: https://charts.crossplane.io/stable
  namespace: {{ crossplane_namespace }}
  includeCRDs: true
  valuesInline:
    args:
      - --{{ crossplane_debug }}

- name: rook-ceph
  releaseName: rook-ceph
  version: {{ rook_ceph_version }}
  repo: https://charts.rook.io/release
  namespace: {{ rook_ceph_namespace }}
  includeCRDs: true
  valuesInline:
    csi:
      kubeletDirPath: {{ rook_csi_kubelet_dir_path }}
    enableDiscoveryDaemon: true
