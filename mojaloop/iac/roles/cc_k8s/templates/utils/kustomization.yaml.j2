apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - namespaces.yaml
  - lets-encrypt-cluster-issuer.yaml
  - istio-gateway-crs.yaml
  - crossplane-providers.yaml
  
secretGenerator:
- name: {{ external_dns_credentials_secret }}
  namespace: {{ external_dns_namespace }}
  files:
  - credentials=ext-dns-crs.cred

helmCharts:

- name: kubernetes-secret-generator
  releaseName: kubernetes-secret-generator
  version: {{ kubernetes_secret_generator_helm_version }}
  namespace: default
  repo: https://helm.mittwald.de
- name: reflector
  releaseName: reflector
  version: {{ reflector_helm_version }}
  repo: https://emberstack.github.io/helm-charts
  namespace: reflector
  valuesInline:
    nameOverride: reflector
- name: base
  releaseName: istio-base
  version: {{ istio_helm_version }}
  repo: https://istio-release.storage.googleapis.com/charts
  valuesFile: istio-base-values.yaml
  namespace: {{ istio_namespace }}
- name: istiod
  releaseName: istiod
  version: {{ istio_helm_version }}
  repo: https://istio-release.storage.googleapis.com/charts
  valuesFile: istio-istiod-values.yaml
  namespace: {{ istio_namespace }}
- name: gateway
  releaseName: int-gateway
  version: {{ istio_helm_version }}
  repo: https://istio-release.storage.googleapis.com/charts
  valuesFile: istio-internal-ingress-gateway-values.yaml
  namespace: {{ istio_internal_gateway_namespace }}
- name: gateway
  releaseName: ext-gateway
  version: {{ istio_helm_version }}
  repo: https://istio-release.storage.googleapis.com/charts
  valuesFile: istio-external-ingress-gateway-values.yaml
  namespace: {{ istio_external_gateway_namespace }}

- name: cert-manager
  releaseName: cert-manager
  version: {{ certmanager_helm_version }}
  repo: https://charts.jetstack.io
  namespace: {{ certmanager_namespace }}
  valuesInline:
    crds.enabled: true

- name: external-dns
  releaseName: external-dns
  version: {{ external_dns_helm_version }}
  repo: https://charts.bitnami.com/bitnami
  valuesFile: ext-dns-values.yaml
  namespace: {{ external_dns_namespace }}

- name: crossplane
  releaseName: crossplane
  version: {{ crossplane_helm_version }}
  repo: https://charts.crossplane.io/stable
  namespace: {{ crossplane_namespace }}
  valuesInline:
    args:
      - --{{ crossplane_debug }}
