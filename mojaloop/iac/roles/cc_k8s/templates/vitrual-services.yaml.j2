apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: zitadel-vs
  namespace: {{ zitadel_namespace }}
spec:
  gateways:
  - {{ istio_external_gateway_namespace }}/{{ istio_external_wildcard_gateway_name }}
  hosts:
    - 'zitadel.{{ dns_public_subdomain }}'
  http:
    - match:
        - uri:
            prefix: /
      route:
        - destination:
            host: zitadel
            port:
              number: 8080
---
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: zit-server-dtrl
  namespace: {{ zitadel_namespace }}
spec:
  host: zitadel
  trafficPolicy:
    tls:
      mode: SIMPLE